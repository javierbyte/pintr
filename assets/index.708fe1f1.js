import{i as e,c as t}from"./vendor.d7bea3fb.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const o=new URL(e,location),a=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,r)=>{const i=new URL(e,o);if(self[t].moduleMap[i])return n(self[t].moduleMap[i]);const c=new Blob([`import * as m from '${i}';`,`${t}.moduleMap['${i}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(c),onerror(){r(new Error(`Failed to import: ${e}`)),a(l)},onload(){n(self[t].moduleMap[i]),a(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("https://javier.xyz/pintr/assets/");const n=.399,o=.587-.05,a=.064;function r(e,t,n,o){let a=0,r=0,i=0;const c=e[0],l=t[0]-e[0],s=e[1],d=t[1]-e[1];let u=1;const m=Math.max(Math.abs(l),Math.abs(d));for(let f=0;f<m;f++){const e=Math.round(c+l/m*f),t=Math.round(s+d/m*f),o=n[e][t],h=f/m+1;u+=h,a+=o.r+h,r+=o.g+h,i+=o.b+h}return o?(a+r+i)/(765*u):[Math.round(a/u),Math.round(r/u),Math.round(i/u)]}function i(e,t,n={}){const{color:o="#0008",close:a=!1,shiftY:r=0}=n;e.beginPath(),e.lineWidth=23,e.moveTo(t[0]._x,t[0]._y+r);for(const i of t)e.lineTo(i._x,i._y+r);a&&e.lineTo(t[0]._x,t[0]._y+r),e.strokeStyle=o,e.stroke()}function c(e){return e.beginPath(),{line:function(t,n,o={}){const{color:a="#000",width:r=1}=o;e.beginPath(),e.lineWidth=r,e.moveTo(t[0],t[1]),e.lineTo(n[0],n[1]),e.strokeStyle=a,e.stroke()},lineBuffer:function(t,n,o={}){e.moveTo(t[0],t[1]),e.lineTo(n[0],n[1])},stroke:function(t={}){const{color:n="#000",width:o=1}=t;e.lineWidth=o,e.strokeStyle=n,e.stroke(),e.beginPath()}}}window.IMAGE_SRC="./test.jpg",window.CURRENT_DRAWING=(new Date).getTime(),window.COORDS=[];const l={singleLine:!0,baseLineNumber:4e3,updateSampleRate:256,addColor:"#000",substractionColor:"rgba(255,255,255,30%)",precisionRange:[16,28]},s=JSON.parse(JSON.stringify(l)),d=document.querySelector("canvas#src"),u=document.querySelector("canvas#draw");u.width=1080,u.height=1080;const m=u.getContext("2d"),f=c(m),h={matrix:[]};async function w(l){window.CURRENT_DRAWING=(new Date).getTime(),window.COORDS=[],m.fillStyle="#fff",m.fillRect(0,0,1080,1080),document.querySelector("#srcimg").style.backgroundImage=`url("${l}")`;const u=await e(l,{size:1080,canvas:d}),{canvasData:w,averageLightness:g}=function(e){let t=e.data,r=1/0,i=0,c=0;for(let s=0;s<t.length;s+=4){let e=t[s]*n+t[s+1]*o+t[s+2]*a;r=Math.min(r,e),i=Math.max(i,e),c+=e}c=Math.round(c/(t.length/4)),r+=32,i-=32;const l=255/(i-r);for(let s=0;s<t.length;s+=4){let e=t[s]*n+t[s+1]*o+t[s+2]*a;t[s]=Math.round(e*l)-r,t[s+1]=Math.round(e*l)-r,t[s+2]=Math.round(e*l)-r}return{canvasData:e,averageLightness:c}}(u);u.ctx.putImageData(w,0,0);try{await async function(e,t){await faceapi.nets.ssdMobilenetv1.loadFromUri("/weights"),await faceapi.nets.faceLandmark68TinyNet.loadFromUri("/weights");const n=await faceapi.detectSingleFace(e).withFaceLandmarks(!0);if(!n)return;const o=n.landmarks.getRightEye(),a=n.landmarks.getLeftEye(),r=n.landmarks.getJawOutline();i(t,o,{close:!0}),i(t,a,{close:!0}),i(t,r.slice(2,-2),{color:"#0004",shiftY:10})}(d,u.ctx)}catch(S){console.warn("no face")}document.querySelector(".loading").style.display="none";const p=u.ctx;h.matrix=t(p);const M=c(u.ctx);let y=[Math.floor(1080*Math.random()),Math.floor(1080*Math.random())];for(;h.matrix[y[0]][y[1]].r+h.matrix[y[0]][y[1]].g+h.matrix[y[0]][y[1]].b===765;)y=[Math.floor(1080*Math.random()),Math.floor(1080*Math.random())];function R(){let e=y,t=s.singleLine?0:2*s.precisionRange[0];for(;t--;){let t=[Math.floor(1080*Math.random()),Math.floor(1080*Math.random())];h.matrix[e[0]][e[1]].r+h.matrix[e[0]][e[1]].g+h.matrix[e[0]][e[1]].b>h.matrix[t[0]][t[1]].r+h.matrix[t[0]][t[1]].g+h.matrix[t[0]][t[1]].b&&(e=t)}let n,o=function(e,t){return Math.min(e,t)+Math.floor(Math.random()*Math.abs(e-t))}(...s.precisionRange),a=1;for(;o--;){let t=[Math.floor(1080*Math.random()),Math.floor(1080*Math.random())];const o=r(e,t,h.matrix,!0);o<=a&&(a=o,n=t)}a=r(e,n,h.matrix,!0),window.COORDS.push([e,n]),f.lineBuffer(e,n,{color:"#000"}),M.lineBuffer(e,n,{color:s.substractionColor}),y=n}let b=Math.floor(s.baseLineNumber/g*128);function v(e){return new Promise((n=>{const o=(new Date).getTime();for(;(new Date).getTime()<o+15&&b-- >0;){if(e!==window.CURRENT_DRAWING)return;b%s.updateSampleRate==0&&(f.stroke({color:s.addColor}),M.stroke({color:s.substractionColor,width:1.5}),h.matrix=t(p)),R()}f.stroke({color:s.addColor}),M.stroke({color:s.substractionColor,width:1.5}),window.requestAnimationFrame(n)}))}!async function(e){for((new Date).getTime();b>0&&e===window.CURRENT_DRAWING;)await v(e)}(window.CURRENT_DRAWING)}function g(){const e=document.querySelector("input[type='range']#lines").value,t=document.querySelector("input[type='range']#singleline").value,n=document.querySelector("input[type='range']#contrast").value,o=document.querySelector("input[type='range']#definition").value;s.baseLineNumber=l.baseLineNumber/50*e,s.substractionColor=`rgba(255, 255, 255, ${100-n}%)`,s.precisionRange=[o,2*o],s.singleLine=!!Number(t),w(window.IMAGE_SRC)}w(window.IMAGE_SRC),document.querySelector("#inp").addEventListener("change",(function(){if(this.files&&this.files[0]){const e=new FileReader;e.addEventListener("load",(function(e){window.IMAGE_SRC=e.target.result,w(window.IMAGE_SRC)})),e.readAsDataURL(this.files[0])}})),document.querySelector("#inputbutton").addEventListener("click",(e=>{document.querySelector("#inp").click()})),document.querySelectorAll("input[type='range']").forEach((e=>{e.addEventListener("change",function(e,t){let n;return function(){clearTimeout(n);let o=arguments;n=setTimeout((function(){e.apply(this,o)}),t||1)}}(g,256))})),document.querySelector("#download").addEventListener("click",(e=>{const t=document.createElement("a");t.download="PINTR.png",t.href=document.querySelector("canvas#draw").toDataURL(),t.click()})),document.querySelector("#downloadsvg").addEventListener("click",(e=>{const t=document.createElement("a");t.download="PINTR.svg";const n=`<svg viewBox="0 0 1080 1080" xmlns="http://www.w3.org/2000/svg">\n  <polyline points="${window.COORDS.map((e=>e[0].join(","))).join(" ")}" fill="none" stroke="black" />\n</svg>\n  `;const o=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(o);t.href=a,t.click()}));
