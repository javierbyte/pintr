(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function o(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(r){if(r.ep)return;r.ep=!0;const i=o(r);fetch(r.href,i)}})();async function gt(t,e){return new Promise(o=>{const{crop:a=!0,size:r,maxSize:i}=e,n=new window.Image;n.onload=function(){const c=e.canvas||document.createElement("canvas"),m=c.getContext("2d");if(!m)throw new Error("Failed to 'getContext2d'");let l=1;r&&(l=r/Math.max(n.width,n.height)),e.maxSize&&(n.width>e.maxSize||n.height>e.maxSize)&&(l=e.maxSize/Math.max(n.width,n.height));const d=Math.floor(n.width*l),g=Math.floor(n.height*l);if(a){c.width=r||i||n.width,c.height=r||i||n.height;const u=Math.min(n.width,n.height);m.drawImage(n,(n.width-u)/2,(n.height-u)/2,u,u,0,0,c.width,c.height)}else c.width=d,c.height=g,m.drawImage(n,0,0,d,g);o({img:n,canvas:c,ctx:m})},n.src=t})}function K(t,e=255){const{data:o}=t.getImageData(0,0,t.canvas.width,t.canvas.height),{width:a,height:r}=t.canvas;let i=[];for(let n=0;n<r;n++)for(let s=0;s<a;s++){i[s]||(i[s]=new Uint8Array(r)),i[s][n]=Math.round((o[n*a*4+s*4]+o[n*a*4+s*4+1]+o[n*a*4+s*4+2])/3);const c=o[n*a*4+s*4+3];c!==255&&(i[s][n]=Math.round(i[s][n]*(c/255)+e*(1-c/255)))}return i}async function ut(t,e){const{ctx:o,canvas:a}=await gt(t,e);return o.getImageData(0,0,a.width,a.height)}function V(t){t.beginPath();function e(r,i,n={color:"#000",width:1}){const{color:s="#000",width:c=1}=n;t.beginPath(),t.lineWidth=c,t.moveTo(r[0],r[1]),t.lineTo(i[0],i[1]),t.strokeStyle=s,t.stroke()}function o(r,i){t.moveTo(r[0],r[1]),t.lineTo(i[0],i[1])}function a(r={color:"#000",width:1}){const{color:i="#000",width:n=1}=r;t.lineWidth=n,t.strokeStyle=i,t.stroke(),t.beginPath()}return{line:e,lineBuffer:o,stroke:a}}const W=.1,L={r:.299+W,g:.587+W*-.5,b:.114+W*-.5};function ht(t){let e=t.data,o=1/0,a=0,r=0;for(let n=0;n<e.length;n+=4){let s=e[n]*L.r+e[n+1]*L.g+e[n+2]*L.b;e[n+3]<128&&(s=255),o=Math.min(o,s),a=Math.max(a,s),r+=s}r=Math.round(r/(e.length/4)),o+=32,a-=32;const i=255/(a-o);for(let n=0;n<e.length;n+=4){let s=e[n]*L.r+e[n+1]*L.g+e[n+2]*L.b;e[n]=Math.round(s*i)-o,e[n+1]=Math.round(s*i)-o,e[n+2]=Math.round(s*i)-o}return{canvasData:t,averageLightness:r}}function Z(t,e,o){let a=0;const r=t[0],i=e[0]-t[0],n=t[1],s=e[1]-t[1],c=Math.max(Math.abs(i),Math.abs(s));for(let m=0;m<c;m++){const l=Math.round(r+i/c*m),d=Math.round(n+s/c*m);a+=o[l][d]}return Math.round(a/c)}function p(t,e){return e===void 0?Math.floor(Math.random()*t):Math.min(t,e)+Math.floor(Math.random()*Math.abs(t-e))}function Q(t,e){let o=0;return function(...a){clearTimeout(o),o=window.setTimeout(()=>t.apply(this,a),e)}}function N(t,e){const o=[...e];if(o.sort((a,r)=>a[0]-r[0]),t<o[0][0]||t>o[o.length-1][0])return console.error(`Value "${t}" out of range`,{value:t,tweens:e,sortedTweens:o}),t;for(const a in e){const r=e[a];if(r[0]===t)return r[1];if(r[0]>t){const i=e[Number(a)-1],n=r[0]-i[0],s=(t-i[0])/n;return s*r[1]+(1-s)*i[1]}}return t}const mt=1080,C=1;let M=[],R=[],P=new Date().getTime()-1;const q=document.createElement("canvas");async function ft(t,{canvasDrawEl:e,onDraw:o,onFinish:a,onLoad:r}){const i=await ut(t,{size:mt,canvas:q,crop:!1}),n=i.width,s=i.height;q.width=n,q.height=s;const c=q.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("Failed to initiate 'CanvasRenderingContext2D'");const m=V(c),l=e||document.createElement("canvas");l.width=n*C,l.height=s*C;const d=document.querySelector("#srcImg"),g=l.getContext("2d");if(!d)throw new Error("Failed to initiate srcImgEl");if(!g)throw new Error("Failed to initiate CanvasRenderingContext2D");d.style.aspectRatio=String(n/s),g.scale(C,C);const u=V(g);console.log("> Starting PINTR"),r({width:n,height:s});const{canvasData:w,averageLightness:b}=ht(i);async function S(D){console.log("> Render PINTR",D);const{density:$,singleLine:A,contrast:B,definition:nt,strokeWidth:_}=D;P=new Date().getTime(),R=[];const x=Math.round(N(nt,[[0,3],[50,15],[100,75]])),ot=Math.round(N($,[[0,500],[50,3e3],[100,7e3]])),rt="rgba(0, 0, 0, 255)",it=`rgba(255, 255, 255, ${(100-Math.round(N(B,[[0,20],[50,67],[100,90]])))/100})`,at=100-Math.floor(x/2);if(!c)throw new Error("Canvas error");c.putImageData(w,0,0),M=K(c);let st=new Date().getTime(),j=[Math.floor(n/2),Math.floor(s/2)];function ct(){let f=j,T=A?0:x;for(;T--;){let E=[p(n),p(s)];M[f[0]][f[1]]>M[E[0]][E[1]]&&(f=E)}let U=p(x,x*2),y=[p(n),p(s)],z=255;for(;U--;){let E=[p(n),p(s)];const Y=Z(f,E,M);Y<=z&&(z=Y,y=E)}z=Z(f,y,M),R.push([f,y]),u.lineBuffer(f,y),m.lineBuffer(f,y),j=y}const X=Math.floor(ot/b*128);let O=X;function lt(f){return new Promise(T=>{const U=new Date().getTime();for(;new Date().getTime()<U+15&&O-- >0;){if(f!==P)return;if(O%at===0){if(m.stroke({color:it,width:_*1.5}),!c)throw new Error("Canvas error");M=K(c)}ct()}u.stroke({color:rt,width:_*1}),window.requestAnimationFrame(T)})}async function dt(f){for(;O>0&&f===P;)await lt(f),o&&o({coords:R});o&&o({coords:R}),a&&a({coords:R});let T=new Date().getTime();console.log("> Lines per second:",X/(T-st)*1e3)}dt(P)}return{render:S}}function wt(t,{strokeWidth:e=1,size:o}){return`<svg viewBox="0 0 ${o[0]} ${o[1]}" xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width="${e}">
${t.map(a=>`<line x1="${a[0][0]}" y1="${a[0][1]}" x2="${a[1][0]}" y2="${a[1][1]}"/>`).join(`
`)}
</svg>
  `}function vt(t,{strokeWidth:e=1,size:o}){return`<svg viewBox="0 0 ${o[0]} ${o[1]}" xmlns="http://www.w3.org/2000/svg">
  <polyline points="${t.map(a=>a[0].join(",")).join(" ")}" fill="none" stroke="black" stroke-width="${e}"/>
</svg>
  `}function pt(t,e){return console.warn(">generateSvg",e),e.singleLine?vt(t,e):wt(t,e)}function G(t,{smoothingAmount:e=50,strokeWidth:o=1,size:a}){const r=t.map(l=>l[0]),i=N(e,[[0,0],[50,.1],[100,1]]),n=(l,d)=>{const g=d[0]-l[0],u=d[1]-l[1];return{length:Math.sqrt(Math.pow(g,2)+Math.pow(u,2)),angle:Math.atan2(u,g)}},s=(l,d,g,u)=>{const S=n(d||l,g||l),D=S.angle+(u?Math.PI:0),$=S.length*i,A=l[0]+Math.cos(D)*$,B=l[1]+Math.sin(D)*$;return[A,B]},c=(l,d,g)=>{const u=s(g[d-1],g[d-2],l),w=s(l,g[d-1],g[d+1],!0);return`C ${u[0]},${u[1]} ${w[0]},${w[1]} ${l[0]},${l[1]}`},m=(l,d)=>`<path d="${l.reduce((u,w,b,S)=>b===0?`M ${w[0]},${w[1]}`:`${u} ${d(w,b,S)}`,"")}" fill="none" stroke="black" stroke-width="${o}" />`;return`<svg viewBox="0 0 ${a[0]} ${a[1]}" xmlns="http://www.w3.org/2000/svg" stroke="black">
    ${m(r,c)}
  </svg>
  `}const St="/pintr/test.jpg";let v={contrast:50,definition:50,density:50,makeSmoothSvg:!1,singleLine:!0,strokeWidth:1,smoothingAmount:50},h={currentImgSrc:St,coords:[],width:512,height:512};async function H(t){const e=document.querySelector("canvas#draw");if(!e)throw new Error;const o=await ft(t,{canvasDrawEl:e,onDraw({coords:i}){h.coords=i},onLoad({width:i,height:n}){document.documentElement.style.setProperty("--sizew",`${i/2}px`),document.documentElement.style.setProperty("--sizeh",`${n/2}px`),h.width=i,h.height=n},onFinish({coords:i}){if(!v.makeSmoothSvg)return;console.warn("MAKING");const n=G(i,{...v,size:[h.width,h.height]}),s=document.querySelector(".smooth-svg-container");s.innerHTML=n}}),a=document.querySelector("#srcImg"),r=document.querySelector(".loading");a&&r&&(a.style.backgroundImage=`url("${t}")`,r.style.display="none"),o.render(v)}function yt(t){t.preventDefault(),t.stopPropagation();const e=t.target;if(!e||!e.files)return;const o=e.files[0];if(o){const a=new FileReader;a.addEventListener("load",function(r){!r||!r.target||(h.currentImgSrc=String(r.target.result),H(String(r.target.result)))}),a.readAsDataURL(o)}}function I(t){const e=document.querySelector(t);return e?Number(e.value):0}function J(t){const e=document.querySelector(t);return e?!!Number(e.value):!1}function tt(){const t=I("#density"),e=J("#singleLine"),o=I("#contrast"),a=I("#definition"),r=I("#strokeWidth"),i=J("#makeSmoothSvg"),n=I("#smoothingAmount");v={density:t,singleLine:e,contrast:o,definition:a,strokeWidth:r,makeSmoothSvg:i,smoothingAmount:n};const s=document.querySelector(".experimental--smoth-svg--container");s.style.display=i?"block":"none";const c=document.querySelector(".experimental--smoth-svg--container--warning");c.style.display=e?"none":"block",H(h.currentImgSrc)}let k=0;function Et(t){if(t.preventDefault(),!t.dataTransfer||!t.dataTransfer.files||!t.dataTransfer.files[0])return;const e=new FileReader;e.addEventListener("load",function(o){!o||!o.target||!o.target.result||(h.currentImgSrc=String(o.target.result),H(String(o.target.result)),document.body.classList.remove("-dragging"),k=0)}),e.readAsDataURL(t.dataTransfer.files[0])}function Lt(t){t.preventDefault(),t.stopPropagation()}function Mt(t){t.stopPropagation(),k++,k?document.body.classList.add("-dragging"):document.body.classList.remove("-dragging")}function It(t){t.stopPropagation(),k--,k?document.body.classList.add("-dragging"):document.body.classList.remove("-dragging")}const F=document.querySelector(".app");F.addEventListener("drop",Et);F.addEventListener("dragover",Lt);F.addEventListener("dragenter",Mt);F.addEventListener("dragleave",It);const et=document.querySelector("#inputImageFile");et.addEventListener("change",yt);const bt=document.querySelector("#inputImageButton");bt.addEventListener("click",()=>{et.click()});document.querySelectorAll("[data-start-drawing]").forEach(t=>{t.addEventListener("change",Q(tt,32))});const Dt=document.querySelector("#smoothingAmount");Dt.addEventListener("change",Q(()=>{v.smoothingAmount=I("#smoothingAmount");const t=G(h.coords,{...v,size:[h.width,h.height]}),e=document.querySelector(".smooth-svg-container");e.innerHTML=t},128));const Tt=document.querySelector("#download");Tt.addEventListener("click",()=>{const t=document.createElement("a"),e=document.querySelector("canvas#draw");t.download="PINTR.png",t.href=e.toDataURL(),t.click()});const Rt=document.querySelector("#downloadSvg");Rt.addEventListener("click",()=>{const t=document.createElement("a");t.download="PINTR.svg";const e=pt(h.coords,{...v,size:[h.width,h.height]}),o=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(o);t.href=a,t.click()});const kt=document.querySelector("#downloadSmoothSvg");kt.addEventListener("click",()=>{const t=document.createElement("a");t.download="PINTR.svg";const e=G(h.coords,{...v,size:[h.width,h.height]}),o=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(o);t.href=a,t.click()});tt();
