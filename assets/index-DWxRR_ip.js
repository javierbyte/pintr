(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();async function ct(t,e){return new Promise(r=>{const{crop:o=!0,size:a,maxSize:i}=e,n=new window.Image;n.onload=function(){const c=e.canvas||document.createElement("canvas"),f=c.getContext("2d");if(!f)throw new Error("Failed to 'getContext2d'");let l=1;a&&(l=a/Math.max(n.width,n.height)),e.maxSize&&(n.width>e.maxSize||n.height>e.maxSize)&&(l=e.maxSize/Math.max(n.width,n.height));const d=Math.floor(n.width*l),u=Math.floor(n.height*l);if(o){c.width=a||i||n.width,c.height=a||i||n.height;const g=Math.min(n.width,n.height);f.drawImage(n,(n.width-g)/2,(n.height-g)/2,g,g,0,0,c.width,c.height)}else c.width=d,c.height=u,f.drawImage(n,0,0,d,u);r({img:n,canvas:c,ctx:f})},n.src=t})}function X(t,e=255){const{data:r}=t.getImageData(0,0,t.canvas.width,t.canvas.height),{width:o,height:a}=t.canvas;let i=[];for(let n=0;n<a;n++)for(let s=0;s<o;s++){i[s]||(i[s]=new Uint8Array(a)),i[s][n]=Math.round((r[n*o*4+s*4]+r[n*o*4+s*4+1]+r[n*o*4+s*4+2])/3);const c=r[n*o*4+s*4+3];c!==255&&(i[s][n]=Math.round(i[s][n]*(c/255)+e*(1-c/255)))}return i}async function lt(t,e){const{ctx:r,canvas:o}=await ct(t,e);return r.getImageData(0,0,o.width,o.height)}function Y(t){t.beginPath();function e(o,a){t.moveTo(o[0],o[1]),t.lineTo(a[0],a[1])}function r(o={color:"#000",width:1}){const{color:a="#000",width:i=1}=o;t.lineWidth=i,t.strokeStyle=a,t.stroke(),t.beginPath()}return{lineBuffer:e,stroke:r}}const z=.1,E={r:.299+z,g:.587+z*-.5,b:.114+z*-.5};function dt(t){let e=t.data,r=1/0,o=0,a=0;for(let n=0;n<e.length;n+=4){let s=e[n]*E.r+e[n+1]*E.g+e[n+2]*E.b;e[n+3]<128&&(s=255),r=Math.min(r,s),o=Math.max(o,s),a+=s}a=Math.round(a/(e.length/4)),r+=32,o-=32;const i=255/(o-r);for(let n=0;n<e.length;n+=4){let s=e[n]*E.r+e[n+1]*E.g+e[n+2]*E.b;e[n]=Math.round(s*i)-r,e[n+1]=Math.round(s*i)-r,e[n+2]=Math.round(s*i)-r}return{canvasData:t,averageLightness:a}}function V(t,e,r){let o=0;const a=t[0],i=e[0]-t[0],n=t[1],s=e[1]-t[1],c=Math.max(Math.abs(i),Math.abs(s)),f=i/c,l=s/c;for(let d=0;d<c;d++){const u=Math.round(a+f*d),g=Math.round(n+l*d);o+=r[u][g]}return Math.round(o/c)}function p(t,e){return e===void 0?Math.floor(Math.random()*t):Math.min(t,e)+Math.floor(Math.random()*Math.abs(t-e))}function Z(t,e){let r=0;return function(...o){clearTimeout(r),r=window.setTimeout(()=>t.apply(this,o),e)}}function q(t,e){const r=[...e];if(r.sort((o,a)=>o[0]-a[0]),t<r[0][0]||t>r[r.length-1][0])return console.error(`Value "${t}" out of range`,{value:t,tweens:e,sortedTweens:r}),t;for(let o=0;o<e.length;o++){const a=e[o];if(a[0]===t)return a[1];if(a[0]>t){const i=e[o-1],n=a[0]-i[0],s=(t-i[0])/n;return s*a[1]+(1-s)*i[1]}}return t}const gt=1080;let M=[],D=[],T=Date.now()-1;const C=document.createElement("canvas");async function ut(t,{canvasDrawEl:e,onDraw:r,onFinish:o,onLoad:a}){const i=await lt(t,{size:gt,canvas:C,crop:!1}),n=i.width,s=i.height;C.width=n,C.height=s;const c=C.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("Failed to initiate 'CanvasRenderingContext2D'");const f=Y(c),l=e||document.createElement("canvas");l.width=n,l.height=s;const d=document.querySelector("#srcImg"),u=l.getContext("2d");if(!d)throw new Error("Failed to initiate srcImgEl");if(!u)throw new Error("Failed to initiate CanvasRenderingContext2D");d.style.aspectRatio=String(n/s);const g=Y(u);a({width:n,height:s});const{canvasData:w,averageLightness:b}=dt(i);async function S(k){const{density:x,singleLine:F,contrast:O,definition:tt,strokeWidth:j}=k;T=Date.now(),D=[];const $=Math.round(q(tt,[[0,3],[50,15],[100,75]])),et=Math.round(q(x,[[0,500],[50,3e3],[100,7e3]])),nt="rgba(0, 0, 0, 255)",ot=`rgba(255, 255, 255, ${(100-Math.round(q(O,[[0,20],[50,67],[100,90]])))/100})`,rt=100-Math.floor($/2);if(!c)throw new Error("Canvas error");c.putImageData(w,0,0),M=X(c);let H=[Math.floor(n/2),Math.floor(s/2)];function at(){let m=H,B=F?0:$;for(;B--;){let L=[p(n),p(s)];M[m[0]][m[1]]>M[L[0]][L[1]]&&(m=L)}let N=p($,$*2),y=[p(n),p(s)],A=255;for(;N--;){let L=[p(n),p(s)];const _=V(m,L,M);_<=A&&(A=_,y=L)}A=V(m,y,M),D.push([m,y]),g.lineBuffer(m,y),f.lineBuffer(m,y),H=y}let U=Math.floor(et/b*128);function it(m){return new Promise(B=>{const N=Date.now();for(;Date.now()<N+15&&U-- >0;){if(m!==T)return;if(U%rt===0){if(f.stroke({color:ot,width:j*1.5}),!c)throw new Error("Canvas error");M=X(c)}at()}g.stroke({color:nt,width:j*1}),window.requestAnimationFrame(B)})}async function st(m){for(;U>0&&m===T;)await it(m),r&&r({coords:D});r&&r({coords:D}),o&&o({coords:D})}st(T)}return{render:S}}function ht(t,{strokeWidth:e=1,size:r}){return`<svg viewBox="0 0 ${r[0]} ${r[1]}" xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width="${e}">
${t.map(o=>`<line x1="${o[0][0]}" y1="${o[0][1]}" x2="${o[1][0]}" y2="${o[1][1]}"/>`).join(`
`)}
</svg>
  `}function mt(t,{strokeWidth:e=1,size:r}){return`<svg viewBox="0 0 ${r[0]} ${r[1]}" xmlns="http://www.w3.org/2000/svg">
  <polyline points="${t.map(o=>o[0].join(",")).join(" ")}" fill="none" stroke="black" stroke-width="${e}"/>
</svg>
  `}function ft(t,e){return e.singleLine?mt(t,e):ht(t,e)}function W(t,{smoothingAmount:e=50,strokeWidth:r=1,size:o}){const a=t.map(l=>l[0]),i=q(e,[[0,0],[50,.1],[100,1]]),n=(l,d)=>{const u=d[0]-l[0],g=d[1]-l[1];return{length:Math.sqrt(Math.pow(u,2)+Math.pow(g,2)),angle:Math.atan2(g,u)}},s=(l,d,u,g)=>{const S=n(d||l,u||l),k=S.angle+(g?Math.PI:0),x=S.length*i,F=l[0]+Math.cos(k)*x,O=l[1]+Math.sin(k)*x;return[F,O]},c=(l,d,u)=>{const g=s(u[d-1],u[d-2],l),w=s(l,u[d-1],u[d+1],!0);return`C ${g[0]},${g[1]} ${w[0]},${w[1]} ${l[0]},${l[1]}`},f=(l,d)=>`<path d="${l.reduce((g,w,b,S)=>b===0?`M ${w[0]},${w[1]}`:`${g} ${d(w,b,S)}`,"")}" fill="none" stroke="black" stroke-width="${r}" />`;return`<svg viewBox="0 0 ${o[0]} ${o[1]}" xmlns="http://www.w3.org/2000/svg" stroke="black">
    ${f(a,c)}
  </svg>
  `}const wt="/pintr/test.jpg";let v={contrast:50,definition:50,density:50,makeSmoothSvg:!1,singleLine:!0,strokeWidth:1,smoothingAmount:50},h={currentImgSrc:wt,coords:[],width:512,height:512};async function G(t){const e=document.querySelector("canvas#draw");if(!e)throw new Error;const r=await ut(t,{canvasDrawEl:e,onDraw({coords:i}){h.coords=i},onLoad({width:i,height:n}){document.documentElement.style.setProperty("--sizew",`${i/2}px`),document.documentElement.style.setProperty("--sizeh",`${n/2}px`),h.width=i,h.height=n},onFinish({coords:i}){if(!v.makeSmoothSvg)return;const n=W(i,{...v,size:[h.width,h.height]}),s=document.querySelector(".smooth-svg-container");s.innerHTML=n}}),o=document.querySelector("#srcImg"),a=document.querySelector(".loading");o&&a&&(o.style.backgroundImage=`url("${t}")`,a.style.display="none"),r.render(v)}function vt(t){t.preventDefault(),t.stopPropagation();const e=t.target;if(!e||!e.files)return;const r=e.files[0];if(r){const o=new FileReader;o.addEventListener("load",function(a){!a||!a.target||(h.currentImgSrc=String(a.target.result),G(String(a.target.result)))}),o.readAsDataURL(r)}}function I(t){const e=document.querySelector(t);return e?Number(e.value):0}function K(t){const e=document.querySelector(t);return e?!!Number(e.value):!1}function J(){const t=I("#density"),e=K("#singleLine"),r=I("#contrast"),o=I("#definition"),a=I("#strokeWidth"),i=K("#makeSmoothSvg"),n=I("#smoothingAmount");v={density:t,singleLine:e,contrast:r,definition:o,strokeWidth:a,makeSmoothSvg:i,smoothingAmount:n};const s=document.querySelector(".experimental--smooth-svg--container");s.style.display=i?"block":"none";const c=document.querySelector(".experimental--smooth-svg--container--warning");c.style.display=e?"none":"block",G(h.currentImgSrc)}let R=0;function pt(t){if(t.preventDefault(),!t.dataTransfer||!t.dataTransfer.files||!t.dataTransfer.files[0])return;const e=new FileReader;e.addEventListener("load",function(r){!r||!r.target||!r.target.result||(h.currentImgSrc=String(r.target.result),G(String(r.target.result)),document.body.classList.remove("-dragging"),R=0)}),e.readAsDataURL(t.dataTransfer.files[0])}function St(t){t.preventDefault(),t.stopPropagation()}function yt(t){t.stopPropagation(),R++,R?document.body.classList.add("-dragging"):document.body.classList.remove("-dragging")}function Lt(t){t.stopPropagation(),R--,R?document.body.classList.add("-dragging"):document.body.classList.remove("-dragging")}const P=document.querySelector(".app");P.addEventListener("drop",pt);P.addEventListener("dragover",St);P.addEventListener("dragenter",yt);P.addEventListener("dragleave",Lt);const Q=document.querySelector("#inputImageFile");Q.addEventListener("change",vt);const Et=document.querySelector("#inputImageButton");Et.addEventListener("click",()=>{Q.click()});document.querySelectorAll("[data-start-drawing]").forEach(t=>{t.addEventListener("change",Z(J,32))});const Mt=document.querySelector("#smoothingAmount");Mt.addEventListener("change",Z(()=>{v.smoothingAmount=I("#smoothingAmount");const t=W(h.coords,{...v,size:[h.width,h.height]}),e=document.querySelector(".smooth-svg-container");e.innerHTML=t},128));const It=document.querySelector("#download");It.addEventListener("click",()=>{const t=document.createElement("a"),e=document.querySelector("canvas#draw");t.download="PINTR.png",t.href=e.toDataURL(),t.click()});const bt=document.querySelector("#downloadSvg");bt.addEventListener("click",()=>{const t=document.createElement("a");t.download="PINTR.svg";const e=ft(h.coords,{...v,size:[h.width,h.height]}),r=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(r);t.href=o,t.click(),setTimeout(()=>URL.revokeObjectURL(o),1e3)});const Dt=document.querySelector("#downloadSmoothSvg");Dt.addEventListener("click",()=>{const t=document.createElement("a");t.download="PINTR.svg";const e=W(h.coords,{...v,size:[h.width,h.height]}),r=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(r);t.href=o,t.click(),setTimeout(()=>URL.revokeObjectURL(o),1e3)});J();
