var oe=Object.defineProperty,re=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var Y=(e,t,n)=>t in e?oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,$=(e,t)=>{for(var n in t||(t={}))ie.call(t,n)&&Y(e,n,t[n]);if(X)for(var n of X(t))se.call(t,n)&&Y(e,n,t[n]);return e},q=(e,t)=>re(e,ae(t));const ce=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}};ce();function K(e,t=255){const{data:n}=e.getImageData(0,0,e.canvas.width,e.canvas.height),{width:r,height:i}=e.canvas;let o=[];for(let a=0;a<i;a++)for(let s=0;s<r;s++){o[s]||(o[s]=new Uint8Array(i)),o[s][a]=Math.floor((n[a*r*4+s*4]+n[a*r*4+s*4+1]+n[a*r*4+s*4+2])/3);const l=n[a*r*4+s*4+3];l!==255&&(o[s][a]=o[s][a]*(l/255)+t*(1-l/255))}return o}function le(e,t={}){const{crop:n=!0,size:r}=t;return new Promise(i=>{const o=new window.Image;o.onload=function(){const s=t.canvas||document.createElement("canvas"),l=s.getContext("2d");let c=1;r&&(c=r/Math.max(o.width,o.height)),t.maxSize&&(o.width>t.maxSize||o.height>t.maxSize)&&(c=t.maxSize/Math.max(o.width,o.height));const d=Math.floor(o.width*c),g=Math.floor(o.height*c);if(n){s.width=r,s.height=r;const h=Math.min(o.width,o.height);l.drawImage(o,(o.width-h)/2,(o.height-h)/2,h,h,0,0,r,r)}else s.width=d,s.height=g,l.drawImage(o,0,0,d,g);const m=l.getImageData(0,0,l.canvas.width,l.canvas.height);m.ctx=l,i(m)},o.src=e})}function Z(e){e.beginPath();function t(i,o,a={}){const{color:s="#000",width:l=1}=a;e.beginPath(),e.lineWidth=l,e.moveTo(i[0],i[1]),e.lineTo(o[0],o[1]),e.strokeStyle=s,e.stroke()}function n(i,o){e.moveTo(i[0],i[1]),e.lineTo(o[0],o[1])}function r(i={}){const{color:o="#000",width:a=1}=i;e.lineWidth=a,e.strokeStyle=o,e.stroke(),e.beginPath()}return{line:t,lineBuffer:n,stroke:r}}const W=.1,S={r:.299+W,g:.587+W*-.5,b:.114+W*-.5};function de(e){let t=e.data,n=1/0,r=0,i=0;for(let a=0;a<t.length;a+=4){let s=t[a]*S.r+t[a+1]*S.g+t[a+2]*S.b;t[a+3]<128&&(s=255),n=Math.min(n,s),r=Math.max(r,s),i+=s}i=Math.round(i/(t.length/4)),n+=32,r-=32;const o=255/(r-n);for(let a=0;a<t.length;a+=4){let s=t[a]*S.r+t[a+1]*S.g+t[a+2]*S.b;t[a]=Math.round(s*o)-n,t[a+1]=Math.round(s*o)-n,t[a+2]=Math.round(s*o)-n}return{canvasData:e,averageLightness:i}}function J(e,t,n){let r=0;const i=e[0],o=t[0]-e[0],a=e[1],s=t[1]-e[1],l=Math.max(Math.abs(o),Math.abs(s));for(let c=0;c<l;c++){const d=Math.round(i+o/l*c),g=Math.round(a+s/l*c);r+=n[d][g]}return Math.round(r/l)}function M(e,t){return t===void 0?Math.floor(Math.random()*e):Math.min(e,t)+Math.floor(Math.random()*Math.abs(e-t))}function Q(e,t){let n;return function(){clearTimeout(n);let r=arguments;n=setTimeout(function(){e.apply(this,r)},t||1)}}const ge=1080,z=1;let L=null,E=null,P=null;const C=document.createElement("canvas");async function ue(e,t={}){const{canvasDrawEl:n,onDraw:r,onFinish:i,onLoad:o}=t,a=await le(e,{size:ge,canvas:C,crop:!1}),s=a.width,l=a.height;C.width=s,C.height=l;const c=C.getContext("2d"),d=Z(c),g=n||document.createElement("canvas");g.width=s*z,g.height=l*z;const m=document.querySelector("#srcImg");m.style.aspectRatio=s/l;const h=g.getContext("2d");h.scale(z,z);const v=Z(h);console.log("> Starting PINTR"),o&&o({width:s,height:l});const{canvasData:y,averageLightness:R}=de(a);async function T({config:p}){console.log("> Render PINTR",p),P=new Date().getTime(),E=[],c.putImageData(y,0,0),L=K(c);let B=new Date().getTime(),G=[Math.floor(s/2),Math.floor(l/2)];function ee(){let f=G,I=p.singleLine?0:p.precisionRange;for(;I--;){let k=[M(s),M(l)];L[f[0]][f[1]]>L[k[0]][k[1]]&&(f=k)}let U=M(p.precisionRange,p.precisionRange*2),x,O=255;for(;U--;){let k=[M(s),M(l)];const _=J(f,k,L);_<=O&&(O=_,x=k)}O=J(f,x,L),E.push([f,x]),v.lineBuffer(f,x,{color:"#000"}),d.lineBuffer(f,x,{color:p.substractionColor}),G=x}const H=Math.floor(p.baseLineNumber/R*128);let F=H;function te(f){return new Promise(I=>{const U=new Date().getTime();for(;new Date().getTime()<U+15&&F-- >0;){if(f!==P)return;F%p.updateSampleRate===0&&(d.stroke({color:p.substractionColor,width:p.strokeWidth*1.5}),L=K(c)),ee()}v.stroke({color:p.addColor,width:p.strokeWidth*1}),window.requestAnimationFrame(I)})}async function ne(f){for(;F>0&&f===P;)await te(f),r&&r({coords:E});r&&r({coords:E}),i&&i({coords:E});let I=new Date().getTime();console.log("> Lines per second:",H/(I-B)*1e3)}ne(P)}return{render:T}}function he(e,{strokeWidth:t,size:n}){return`<svg viewBox="0 0 ${n[0]} ${n[1]}" xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width="${t}">
${e.map(r=>`<line x1="${r[0][0]}" y1="${r[0][1]}" x2="${r[1][0]}" y2="${r[1][1]}"/>`).join(`
`)}
</svg>
  `}function me(e,{strokeWidth:t,size:n}){return`<svg viewBox="0 0 ${n[0]} ${n[1]}" xmlns="http://www.w3.org/2000/svg">
  <polyline points="${e.map(r=>r[0].join(",")).join(" ")}" fill="none" stroke="black" stroke-width="${t}"/>
</svg>
  `}function pe(e,t){return console.warn(">generateSvg",t),t.singleLine?me(e,t):he(e,t)}function A(e,{smoothing:t=.15,strokeWidth:n,size:r}){const i=e.map(c=>c[0]),o=(c,d)=>{const g=d[0]-c[0],m=d[1]-c[1];return{length:Math.sqrt(Math.pow(g,2)+Math.pow(m,2)),angle:Math.atan2(m,g)}},a=(c,d,g,m)=>{const y=o(d||c,g||c),R=y.angle+(m?Math.PI:0),T=y.length*t,p=c[0]+Math.cos(R)*T,B=c[1]+Math.sin(R)*T;return[p,B]},s=(c,d,g)=>{const m=a(g[d-1],g[d-2],c),h=a(c,g[d-1],g[d+1],!0);return`C ${m[0]},${m[1]} ${h[0]},${h[1]} ${c[0]},${c[1]}`},l=(c,d)=>`<path d="${c.reduce((m,h,v,y)=>v===0?`M ${h[0]},${h[1]}`:`${m} ${d(h,v,y)}`,"")}" fill="none" stroke="black" stroke-width="${n}" />`;return`<svg viewBox="0 0 ${r[0]} ${r[1]}" xmlns="http://www.w3.org/2000/svg" stroke="black">
    ${l(i,s)}
  </svg>
  `}const fe="./test.jpg";let w={},u={currentImgSrc:fe,coords:null,width:null,height:null};async function j(e){const t=await ue(e,{canvasDrawEl:document.querySelector("canvas#draw"),onDraw({coords:n}){u.coords=n},onLoad({width:n,height:r}){document.documentElement.style.setProperty("--sizew",`${n/2}px`),document.documentElement.style.setProperty("--sizeh",`${r/2}px`),u.width=n,u.height=r},onFinish({coords:n}){if(!w.makeSmoothSvg)return;const r=A(n,q($({},w),{size:[u.width,u.height],smoothing:Number(document.querySelector("#inputSmoothness").value)/100}));document.querySelector(".smooth-svg-container").innerHTML=r}});document.querySelector("#srcImg").style.backgroundImage=`url("${e}")`,document.querySelector(".loading").style.display="none",t.render({config:w})}function we(e){if(e.preventDefault(),e.stopPropagation(),this.files&&this.files[0]){const t=new FileReader;t.addEventListener("load",function(n){u.currentImgSrc=n.target.result,j(n.target.result)}),t.readAsDataURL(this.files[0])}}function D(e,t){return t==="number"?Number(document.querySelector(e).value):t==="bool"?Boolean(Number(document.querySelector(e).value)):document.querySelector(e).value}function V(){const e=D("#lines","number"),t=D("#singleLine","bool"),n=D("#contrast","number"),r=D("#definition","number"),i=D("#strokeWidth","number"),o=D("#makeSmoothSvg","bool");w={addColor:"#000",updateSampleRate:90,baseLineNumber:72*e,substractionColor:`rgba(255, 255, 255, ${100-n}%)`,precisionRange:r,singleLine:t,strokeWidth:i,makeSmoothSvg:t&&o},document.querySelector(".experimental--smoth-svg--container").style.display=o?"block":"none",document.querySelector(".experimental--smoth-svg--container--warning").style.display=t?"none":"block",j(u.currentImgSrc)}let b=0;function be(e){if(console.log("File(s) dropped"),e.preventDefault(),!e.dataTransfer.files||!e.dataTransfer.files[0])return;const t=new FileReader;t.addEventListener("load",function(n){u.currentImgSrc=n.target.result,j(n.target.result),document.body.classList.remove("-dragging"),b=0}),t.readAsDataURL(e.dataTransfer.files[0])}function ve(e){e.preventDefault(),e.stopPropagation()}function ye(e){e.stopPropagation(),b++,console.log(b),b?document.body.classList.add("-dragging"):document.body.classList.remove("-dragging")}function xe(e){e.stopPropagation(),b--,console.log(b),b?document.body.classList.add("-dragging"):document.body.classList.remove("-dragging")}const N=document.querySelector(".app");N.addEventListener("drop",be);N.addEventListener("dragover",ve);N.addEventListener("dragenter",ye);N.addEventListener("dragleave",xe);document.querySelector("#inputImageFile").addEventListener("change",we);document.querySelector("#inputImageButton").addEventListener("click",()=>{document.querySelector("#inputImageFile").click()});document.querySelectorAll("[data-start-drawing]").forEach(e=>{e.addEventListener("change",Q(V,256))});document.querySelector("#inputSmoothness").addEventListener("change",Q(()=>{const e=A(u.coords,q($({},w),{size:[u.width,u.height],smoothing:document.querySelector("#inputSmoothness").value/100}));document.querySelector(".smooth-svg-container").innerHTML=e},128));document.querySelector("#download").addEventListener("click",()=>{const e=document.createElement("a");e.download="PINTR.png",e.href=document.querySelector("canvas#draw").toDataURL(),e.click()});document.querySelector("#downloadSvg").addEventListener("click",()=>{const e=document.createElement("a");e.download="PINTR.svg";const t=pe(u.coords,q($({},w),{size:[u.width,u.height]})),n=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),r=URL.createObjectURL(n);e.href=r,e.click()});document.querySelector("#downloadSmoothSvg").addEventListener("click",()=>{const e=document.createElement("a");e.download="PINTR.svg";const t=A(u.coords,{CONFIG:w,size:[u.width,u.height],smoothing:document.querySelector("#inputSmoothness").value/100}),n=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),r=URL.createObjectURL(n);e.href=r,e.click()});V();
