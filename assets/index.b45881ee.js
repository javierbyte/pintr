var ee=Object.defineProperty,te=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var H=(e,t,n)=>t in e?ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,I=(e,t)=>{for(var n in t||(t={}))oe.call(t,n)&&H(e,n,t[n]);if(j)for(var n of j(t))re.call(t,n)&&H(e,n,t[n]);return e},q=(e,t)=>te(e,ne(t));import{i as se,c as z}from"./vendor.2ac2f24a.js";const ae=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}};ae();function _(e){e.beginPath();function t(r,s,a={}){const{color:l="#000",width:h=1}=a;e.beginPath(),e.lineWidth=h,e.moveTo(r[0],r[1]),e.lineTo(s[0],s[1]),e.strokeStyle=l,e.stroke()}function n(r,s){e.moveTo(r[0],r[1]),e.lineTo(s[0],s[1])}function o(r={}){const{color:s="#000",width:a=1}=r;e.lineWidth=a,e.strokeStyle=s,e.stroke(),e.beginPath()}return{line:t,lineBuffer:n,stroke:o}}const U=.1,b={r:.299+U,g:.587+U*-.5,b:.114+U*-.5};function ie(e){let t=e.data,n=1/0,o=0,r=0;for(let a=0;a<t.length;a+=4){let l=t[a]*b.r+t[a+1]*b.g+t[a+2]*b.b;n=Math.min(n,l),o=Math.max(o,l),r+=l}r=Math.round(r/(t.length/4)),n+=32,o-=32;const s=255/(o-n);for(let a=0;a<t.length;a+=4){let l=t[a]*b.r+t[a+1]*b.g+t[a+2]*b.b;t[a]=Math.round(l*s)-n,t[a+1]=Math.round(l*s)-n,t[a+2]=Math.round(l*s)-n}return{canvasData:e,averageLightness:r}}function X(e,t,n){let o=0;const r=e[0],s=t[0]-e[0],a=e[1],l=t[1]-e[1],h=Math.max(Math.abs(s),Math.abs(l));for(let i=0;i<h;i++){const c=Math.round(r+s/h*i),u=Math.round(a+l/h*i);o+=n[c][u]}return Math.round(o/h)}function T(e,t){return t===void 0?Math.floor(Math.random()*e):Math.min(e,t)+Math.floor(Math.random()*Math.abs(e-t))}function Y(e,t){let n;return function(){clearTimeout(n);let o=arguments;n=setTimeout(function(){e.apply(this,o)},t||1)}}const le=1080,N=1;let L=null,E=null,P=null;const C=document.createElement("canvas");async function ce(e,t={}){const{canvasDrawEl:n,onDraw:o,onFinish:r,onLoad:s}=t,a=await se(e,{size:le,canvas:C,crop:!1}),l=a.width,h=a.height;C.width=l,C.height=h;const i=C.getContext("2d"),c=_(i),u=n||document.createElement("canvas");u.width=l*N,u.height=h*N;const f=u.getContext("2d");f.scale(N,N);const w=_(f);console.log("> Starting PINTR"),s&&s({width:l,height:h});const{canvasData:M,averageLightness:p}=ie(a);async function $({config:m}){console.log("> Render PINTR",m),P=new Date().getTime(),E=[],i.putImageData(M,0,0),L=z(i);let x=new Date().getTime(),D=[Math.floor(l/2),Math.floor(h/2)];function J(){let g=D,R=m.singleLine?0:m.precisionRange;for(;R--;){let y=[T(l),T(h)];L[g[0]][g[1]]>L[y[0]][y[1]]&&(g=y)}let F=T(m.precisionRange,m.precisionRange*2),S,O=255;for(;F--;){let y=[T(l),T(h)];const A=X(g,y,L);A<=O&&(O=A,S=y)}O=X(g,S,L),E.push([g,S]),w.lineBuffer(g,S,{color:"#000"}),c.lineBuffer(g,S,{color:m.substractionColor}),D=S}const G=Math.floor(m.baseLineNumber/p*128);let B=G;function Q(g){return new Promise(R=>{const F=new Date().getTime();for(;new Date().getTime()<F+15&&B-- >0;){if(g!==P)return;B%m.updateSampleRate==0&&(c.stroke({color:m.substractionColor,width:m.strokeWidth*1.5}),L=z(i)),J()}w.stroke({color:m.addColor,width:m.strokeWidth*1}),window.requestAnimationFrame(R)})}async function V(g){for(;B>0&&g===P;)await Q(g),o&&o({coords:E});o&&o({coords:E}),r&&r({coords:E});let R=new Date().getTime();console.log("> Lines per second:",G/(R-x)*1e3)}V(P)}return{render:$}}function ue(e,{strokeWidth:t,size:n}){return`<svg viewBox="0 0 ${n[0]} ${n[1]}" xmlns="http://www.w3.org/2000/svg" stroke="black" stroke-width="${t}">
${e.map(o=>`<line x1="${o[0][0]}" y1="${o[0][1]}" x2="${o[1][0]}" y2="${o[1][1]}"/>`).join(`
`)}
</svg>
  `}function de(e,{strokeWidth:t,size:n}){return`<svg viewBox="0 0 ${n[0]} ${n[1]}" xmlns="http://www.w3.org/2000/svg">
  <polyline points="${e.map(o=>o[0].join(",")).join(" ")}" fill="none" stroke="black" stroke-width="${t}"/>
</svg>
  `}function he(e,t){return console.warn(">generateSvg",t),t.singleLine?de(e,t):ue(e,t)}function W(e,{smoothing:t=.15,strokeWidth:n,size:o}){const r=e.map(i=>i[0]),s=(i,c)=>{const u=c[0]-i[0],f=c[1]-i[1];return{length:Math.sqrt(Math.pow(u,2)+Math.pow(f,2)),angle:Math.atan2(f,u)}},a=(i,c,u,f)=>{const p=s(c||i,u||i),$=p.angle+(f?Math.PI:0),m=p.length*t,x=i[0]+Math.cos($)*m,D=i[1]+Math.sin($)*m;return[x,D]},l=(i,c,u)=>{const f=a(u[c-1],u[c-2],i),w=a(i,u[c-1],u[c+1],!0);return`C ${f[0]},${f[1]} ${w[0]},${w[1]} ${i[0]},${i[1]}`},h=(i,c)=>`<path d="${i.reduce((f,w,M,p)=>M===0?`M ${w[0]},${w[1]}`:`${f} ${c(w,M,p)}`,"")}" fill="none" stroke="black" stroke-width="${n}" />`;return`<svg viewBox="0 0 ${o[0]} ${o[1]}" xmlns="http://www.w3.org/2000/svg" stroke="black">
    ${h(r,l)}
  </svg>
  `}const me="./test.jpg";let v={},d={currentImgSrc:me,coords:null,width:null,height:null};async function K(e){const t=await ce(e,{canvasDrawEl:document.querySelector("canvas#draw"),onDraw({coords:n}){d.coords=n},onLoad({width:n,height:o}){document.documentElement.style.setProperty("--sizew",`${n/2}px`),document.documentElement.style.setProperty("--sizeh",`${o/2}px`),d.width=n,d.height=o},onFinish({coords:n}){if(!v.makeSmoothSvg)return;const o=W(n,q(I({},v),{size:[d.width,d.height],smoothing:Number(document.querySelector("#inputSmoothness").value)/100}));document.querySelector(".smooth-svg-container").innerHTML=o}});document.querySelector("#srcImg").style.backgroundImage=`url("${e}")`,document.querySelector(".loading").style.display="none",t.render({config:v})}function ge(){if(this.files&&this.files[0]){const e=new FileReader;e.addEventListener("load",function(t){d.currentImgSrc=t.target.result,K(t.target.result)}),e.readAsDataURL(this.files[0])}}function k(e,t){return t==="number"?Number(document.querySelector(e).value):t==="bool"?Boolean(Number(document.querySelector(e).value)):document.querySelector(e).value}function Z(){const e=k("#lines","number"),t=k("#singleLine","bool"),n=k("#contrast","number"),o=k("#definition","number"),r=k("#strokeWidth","number"),s=k("#makeSmoothSvg","bool");v={addColor:"#000",updateSampleRate:90,baseLineNumber:72*e,substractionColor:`rgba(255, 255, 255, ${100-n}%)`,precisionRange:o,singleLine:t,strokeWidth:r,makeSmoothSvg:t&&s},document.querySelector(".experimental--smoth-svg--container").style.display=s?"block":"none",document.querySelector(".experimental--smoth-svg--container--warning").style.display=t?"none":"block",K(d.currentImgSrc)}Z();document.querySelector("#inputImageFile").addEventListener("change",ge);document.querySelector("#inputImageButton").addEventListener("click",()=>{document.querySelector("#inputImageFile").click()});document.querySelectorAll("[data-start-drawing]").forEach(e=>{e.addEventListener("change",Y(Z,256))});document.querySelector("#inputSmoothness").addEventListener("change",Y(()=>{const e=W(d.coords,q(I({},v),{size:[d.width,d.height],smoothing:document.querySelector("#inputSmoothness").value/100}));document.querySelector(".smooth-svg-container").innerHTML=e},128));document.querySelector("#download").addEventListener("click",()=>{const e=document.createElement("a");e.download="PINTR.png",e.href=document.querySelector("canvas#draw").toDataURL(),e.click()});document.querySelector("#downloadSvg").addEventListener("click",()=>{const e=document.createElement("a");e.download="PINTR.svg";const t=he(d.coords,q(I({},v),{size:[d.width,d.height]})),n=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(n);e.href=o,e.click()});document.querySelector("#downloadSmoothSvg").addEventListener("click",()=>{const e=document.createElement("a");e.download="PINTR.svg";const t=W(d.coords,{CONFIG:v,size:[d.width,d.height],smoothing:document.querySelector("#inputSmoothness").value/100}),n=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(n);e.href=o,e.click()});
